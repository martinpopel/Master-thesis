\chapter{Lyrics evaluation}

\section{Rhyme detection}
\subsection{Rhyme types}
Although everyone instinctively knows what a rhyme is and can recognize one in a poem or a song, it does not have a very precise definition. It is described as "a word that has the same last sound as another word" by Cambridge Dictionary (\cite{walter2008cambridge}) or a "literary device, featured particularly in poetry, in which identical or similar concluding syllables in different words are repeated" by \cite{literarydevices2020}. These definitions are not detailed enough to base a good algorithm off of, so let's look deeper into different rhyme types.

\paragraph{Perfect rhyme} (also true rhyme, or sometimes just "rhyme") is the most common and valued \todo{cite?} type of rhyme. It requires two conditions to be met:

\begin{itemize}
	\item last stressed vowel and all following sounds are identical
	\item immediately preceding sounds differ
\end{itemize}

It is also the only rhyme for which the definitions are consistent (for example, see \cite{bain1867manual}, \cite{vanphonological}, \cite{bergman2017litcharts}, \footnote{https://en.wikipedia.org/wiki/Rhyme}). It can be further distinguished depending on how many syllables are involved:

\begin{itemize}
	\item \textbf{Masculine} (also single, monosyllabic) - "the commonest kind of rhyme, between single stressed syllables at the ends of verse" (\cite{oxforddict2008literary}). Examples: fly/sky, before/explore.
	\item \textbf{Feminine} (also double) - "a rhyme on two syllables, the first stressed and the second unstressed" (\cite{oxforddict2008literary}). Examples: bitten/written, lazy/crazy. 
	\item \textbf{Dactylic} (also triple) - "a rhyme on three syllables, the first stressed and the others unstressed"(\cite{oxforddict2008literary}). Examples: amorous/glamorous, beautiful/dutiful.
\end{itemize}

\paragraph{Imperfect rhyme} (also slant or half rhyme)  rhymes "the stressed syllable of one word with the unstressed syllable of another word" (\cite{bergman2017litcharts}). Examples: uptown/frown, painting/ring. In other sources, definitions differ - for example \cite{literarydevices2020} calls this effect "feminine rhyme".  On the other hand, \cite{oxforddict2008literary} and \cite{britannica} use the term "imperfect rhyme" for end-line consonance (see definition below) and \cite{vanphonological} uses it for end-line assonance (see definition below). For the purpose of this thesis we will work with the first definition mentioned.

\paragraph{Unaccented rhyme} (also weakened rhyme) "occurs when the relevant syllable of the rhyming word is unstressed" (\cite{britannica}). Examples: hammer/carpenter.
\todo[inline]{Maybe join this with imperfect? It's quite similar.}

\paragraph{Identical rhyme} (also rime riche) is "a kind of rhyme in which the rhyming elements include matching consonants before the stressed vowel sounds." This includes "rhyming of two words with the same sound and sometimes the same spelling but different meanings e.g seen/scene. The term also covers word‚Äêendings where the consonant preceding the stressed vowel sound is the same: compare/despair." (\cite{oxforddict2008literary}). It is generally considered not as good as perfect rhyme because it is too predictable for the listener\footnote{https://literaryterms.net/rhyme/}.
 
\paragraph{Forced rhyme} (also near rhyme) "includes words with a close but imperfect match in sound in the final syllables" \cite{bergman2017litcharts}. Examples: green/fiend, hide/mind. This include the case when spelling in changed in order to make the rhyme work, e.g. truth/endu'th (a contraction of "endureth"). It can also refer to using unnatural word order to get the rhyming word at the end of the line (\cite{bergman2017litcharts}) but we will not make use of this interpretation in this thesis.

\paragraph{Assonance} is "repetition of stressed vowel sounds within words with different end consonants" (\cite{britannica}). Examples:	quite/like, free/breeze. The term itself defines a literary device applicable anywhere in the poem but when used at the end of verse, it is considered a rhyme (under various names) by sources like \cite{vanphonological}, \cite{bergman2017litcharts} and others.

\paragraph{Consonance} is "the recurrence or repetition of identical or similar consonants" (\cite{britannica}). Examples: country/contra, hickory dickory dock. Similarly as assonance, it applies to repetition anywhere. When seen at the end of verse, it's considered a rhyme and again, various terms are used, perhaps the most common is "pararhyme" (\cite{britannica}, \cite{oxforddict2008literary}).\newline


The last and penultimate term may seem as more of a tool for poets than songwriters. Surprisingly, they have found their way into song lyrics and have become a standard in genres like hip hop according to \cite{vanphonological}. From the creative point of view, it is not less sophisticated rather it enriches rhyme as we know it (\cite{brogan2016poeticterms}).

Other rhyme types exist e.g. eye rhyme where "the spellings of the rhyming elements match, but the sounds do not, e.g. love/prove" (\cite{oxforddict2008literary}). We will be omitting them because we did not consider them relevant for song lyrics or the purpose of this thesis.

\todo[inline]{I'm not sure about this part. I spent hours looking for an article that would contain all definitions, or at least most, unsuccessfully. They usually just define it vaguely and without citation or inconsistently. So I spent the rest of the day putting this together - most resources were on webpages but I don't know if that's good enough.}

\todo[inline]{Should I somehow stylistically separate the examples? e.g. in italics on newline or I don't know, it looks a bit weird how it is.}
\todo[inline]{Not sure how to connect this with the rest. Maybe it will fit more with the website demo or final statistical rhyme analysis of the dataset.}

\subsection{Pronunciation}
Unlike many other languages, English does not have a straight forward pronunciation rules. Therefore to be able to assess rhymes, we need to transcribe our text into a phonetic alphabet first. There are two commonly used alphabets to choose from - IPA and ARPAbet. The original International Phonetic Alphabet (IPA) used since 1888 uses one UNICODE character to encode each phoneme and it is commonly used for example in dictionaries. Since it uses non-ASCII characters, ARPAbet was developed as an equivalent for computers. It has two versions: 1-character that uses upper-case and lower-case letters and 2-character version where each phoneme is represented by one or more upper-case ASCII characters (\cite{klautau2001arpabet})(see Table\ref{pronunciation_table} for comparison). We will be using 2-character ARPAbet because it is used by CMU dictionary.

\begin{table}[h!]
	\centering
	\begin{tabular}{c c c c} 
		Example word & IPA & 1-character ARPAbet & 2-character ARPAbet \\ [0.5ex] 
		\hline
		st\textbf{o}ry & \textipa{O} & c & AO \\ 
		bu\textbf{tt}er & \textipa{R} & F & DX \\
	\end{tabular}
	\caption{Comparison of different pronunciation alphabets.}
	\label{pronunciation_table}
\end{table}

Carnegie Mellon University Pronouncing Dictionary (CMUdict) is an open-source pronunciation dictionary.\footnote{http://www.speech.cs.cmu.edu/cgi-bin/cmudict} Currently it contains 134,373 words (including their inflections) and their pronunciations in 2-character ARPAbet. \todo[inline]{Check the number - including lemmas?}
For each word there is one or several possible pronunciations in North American English including stress markers for primary, secondary or no stress. For the implementation we used its python wrapper package \textit{cmudict}.\footnote{https://pypi.org/project/cmudict/}

This is a large dictionary and it includes also slang words so it should cover most of our input. To test this, we looked at all last words on each line of our data (since those are the important ones for rhyme analysis) and we found out that 5.52\% of them are not in CMU dictionary. These included:

\begin{itemize}
	\item uncommon words, e.g. superglue, redundantly
	\item misspelled words, e.g. decsion, girlfren
	\item numbers
	\item foreign words, e.g. revoluccion, ecolli
	\item interjections and onomatopoeia, e.g. shoooshooo, woahwoah
\end{itemize}

\todo[inline]{Describe here how we dealt with the ones not in CMUdict.}

\subsection{Syllabification}
Once we have the pronunciations we can start to compare them. When comparing lines for rhymes we have to establish a system of alignment so that we analyze only relevant pairs of phonemes. Initially, we created a simple rhyme detector that just traversed both verses backwards phoneme by phoneme and compared them. However, rhyming words don't have to have an equal number of phonemes. For example words in the Table \ref{phon_misalign_table} have a 2-syllable rhyme. However if we compared each phonemes one by one they get misaligned on consonant clusters S-T-R and P-L and we will miss the second syllable rhyme.

\begin{table}[h!]
	\centering
	\begin{tabular}{c c} 
		Word & ARPAbet transcription \\ [0.5ex] 
		\hline
		constrain & K AH N - S T R EY N \\ 
		complain & K AH M - P L EY N \\
	\end{tabular}
	\caption{Example of misalignment when aligning by phonemes.}
	\label{phon_misalign_table}
\end{table}

We need to make sure that we are comparing corresponding parts of verses otherwise we will miss the rhyme. A better approach would be to compare corresponding syllables. Each syllable can be further split into 3 groups ("CVC") - leading consonant cluster, vowel, and trailing consonant cluster. Consonant clusters can sometimes be empty. For syllabification we used python library \textit{syllabify} \footnote{https://github.com/kylebgorman/syllabify} which conveniently returns syllables in CVC triplets as described above.

\begin{table}[h!]
	\centering
	\begin{tabular}{c} 
	She's in the Class \textbf{A Team} \\
	Stuck in her \textbf{daydream} \\
	\end{tabular}
	\caption{Example of multiword rhyme from song "The A Team" by Ed Sheeran.}
	\label{multiword_rhyme_table}
\end{table}

Rhymes are located at the end of each line so there is no need to analyze the entire verse. How far should we look? The first choice would be to look at the last word. However rhymes can extend over more words as we see in Table \ref{multiword_rhyme_table}. To avoid being affected by word boundaries we decided to look at a fixed number of last syllables. We chose 4 last syllables because rhymes in music lyrics are usually not so sophisticated to exceed it.

\section{Rating}

